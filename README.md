# 프로젝트 소개 (Unreal Engine 5 멀티플레이 퍼즐 게임)

## 1. 게임 개요
본 프로젝트는 **데디케이티드 서버 기반 2인 협동 퍼즐 게임**입니다.  
플레이어는 로비에서 기본 조작을 익힌 뒤, 매칭 장소에서 **2명이 모두 준비(Ready)**를 완료하면 자동으로 메인 콘텐츠인 **8개의 퍼즐 맵**으로 입장합니다.  
퍼즐을 클리어하면 **엔딩 크레딧**이 재생되고, 이후 **로비 맵으로 복귀**하는 구조로 구성했습니다.

---

## 2. 게임 흐름 (Flow)
1) **로비 맵 시작**  
- 기본 조작 학습 및 UI 안내 확인

2) **매칭 장소에서 2인 준비**  
- 두 플레이어가 Ready 상태가 되면 자동 진행

3) **퍼즐 맵(총 8개) 입장 및 진행**  
- 협동 기믹 및 아이템/스태미나 활용

4) **클리어 → 엔딩 크레딧**  

5) **로비 맵 복귀 + 퍼즐 상태 리셋**  
- 다음 플레이를 위해 퍼즐 맵 상태를 초기화

---

## 3. 파트별 구현 내용

### 3.1 캐릭터(Character)
- 퍼즐 클리어를 위한 **기본 이동/조작 시스템**
- 퍼즐 기믹 해결을 위한 **퍼즐 아이템 장착/버리기**
- 기믹 사용 시 점차 감소하는 **스태미나 시스템**

### 3.2 아이템(Item)
- **사용 시 스태미나 회복** 후 사라지는 촛불 아이템
- **지속 스태미나 회복**을 제공하는 제단 아이템
- 짧은 시간 동안 이동속도를 크게 증가시키는 **가속 아이템**

### 3.3 AI
- 일정 범위 내 플레이어를 자동 타겟팅하여 **추적(Chase)**
- 점프 이동 구현을 위해 **스켈레탈 메쉬 제작**
- 해당 메쉬 기반으로 **블렌드 스페이스**를 활용해 점프 이동 애니메이션 구현

### 3.4 퍼즐 시스템(Puzzle System)
퍼즐 핵심 기믹 3종을 구현했습니다.

1) **아이템 연동 드랍 기믹**  
- 한쪽에서 특정 위치에 드랍하면 반대쪽 위치에 동일하게 드랍

2) **발판 연동 지형 이동 기믹**  
- 한쪽 발판을 밟으면 반대쪽에서 지형이 이동

3) **협동 타겟 정렬/맞추기 기믹**  
- 두 플레이어가 특정 액터에 맞춰야 다음 퍼즐 진행 가능

### 3.5 서버(Server)
- 입장 직후 바로 퍼즐로 넘어가는 것을 방지하기 위한 **2인 Ready 기반 입장 시스템**
- 클리어 시 **로비 자동 복귀**
- 퍼즐 맵 상태를 게임 시작 시점과 동일하게 만드는 **리셋(초기화) 시스템**

### 3.6 UI / 맵 디자인(UI & Level Design)
- 게임 시작 시 진행 여부를 묻는 UI
- 조작 설명 UI
- 캐릭터 상태 UI
- 게임 설정 UI
- 게임의 마지막을 장식하는 **엔딩 연출(Ending)** 제작

---

## 4. 트러블 슈팅(Trouble Shooting)

### 4.1 캐릭터 - 달리기 애니메이션(다리 절음) 문제
**문제**
- 이동속도 값만 바꾸면 속도는 적용되지만 애니메이션이 자연스럽지 않고 “다리가 절듯이” 보이는 현상 발생

**원인 분석**
- 클라이언트/서버 간 속도 및 상태 불일치 여부를 측정
- 속도 값 차이를 맞춰도 문제 지속 → **서버는 달리기 상태로 인식하지만 클라이언트가 동일 상태로 인식하지 못하는 복제 문제**로 판단

**해결**
- 달리기 상태를 명확히 표현하는 **상태 변수**를 생성하고 클라이언트로 **Replication(복제)**하여 동기화 문제 해결

---

### 4.2 AI - 점프가 1회만 실행되고 반복되지 않는 문제
**문제**
- 몬스터가 반복 점프/이동을 해야 하는데 한 번만 실행되고 이후 동작이 멈춤

**해결**
- 시퀀스 노드에서 점프 종료 후 다시 돌아가도록 로직 수정 → 반복 동작 구현
- 캐릭터 오브젝트 레퍼런스를 가져와 자동 추적(Chase) 동작 완성

---

### 4.3 아이템 - 제단 회복 동기화/타이머 꼬임 및 메모리 누수
**문제**
- 회복 제단에서 **한 명만 회복되거나**
- 캐릭터별 타이머가 어긋나며 **메모리 누수 발생**

**해결**
- 자료구조를 활용해 **플레이어별 상태를 각각 관리**하도록 변경하여 동기화/누수 문제 해결

*(참고: 촛불 회복 등 컴포넌트 기반 스탯 조정 방식은 캐릭터와 협업하며 네트워크 동기화 문제 없이 안정적으로 동작)*

---

### 4.4 퍼즐 시스템 - 아이템 드랍 시 간헐적으로 바닥을 뚫고 사라지는 문제
**문제**
- 물체를 놓을 때 중력을 사용 → 네트워크 환경에서 간헐적으로 바닥을 뚫고 사라짐

**원인**
- 싱글(비네트워크)에서는 정상 → 네트워크 동기화 과정에서 충돌/판정 문제로 바닥 통과 발생

**해결**
- 기본 바닥 아래에 **두께가 있는 메쉬**를 추가로 배치하여 관통되지 않도록 수정

---

### 4.5 퍼즐 시스템 - 양쪽에서 닫히는 문이 겹쳐서 막히는 문제
**문제**
- 문 위치가 0에 고정되며 서로 겹쳐 완전히 막아버림

**해결**
- 위치값 보정 및 이동거리 계산을 수정하여 **겹치지 않도록 처리**

---

### 4.6 서버 - 맵 이동 후 이전 맵이 초기화되지 않는 문제
**문제**
- 맵 이동 이후 이전 맵이 제대로 초기화되지 않음  
- 플레이어 연결 속도 차이로 특정 조건(플레이어 0)이 기대대로 실행되지 않음

**해결**
- 초기화 로직을 별도로 분리
- 서버 월드 시간(`GetWorldTimer`) 기반으로 플레이어 간 시간을 맞춰  
  **완전히 맵에서 빠져나간 이후 초기화**가 수행되도록 구현

---

### 4.7 맵 디자인 - 레이어가 적용되지 않는 문제
**문제**
- 레이어가 적용되지 않음

**해결**
- 이름 불일치 문제를 확인하여 **이름을 일치**
- 플러그인 불일치도 확인되어 **필요 플러그인 설치**로 해결

---

## 5. 영상(데모)
- https://youtu.be/IT8bSqwMC9U?si=ZwlHkbmh5dG7_p4g

---

## 6. 개발 환경
- Engine: Unreal Engine 5
- Network: Dedicated Server 기반 멀티플레이
- Players: 2인 협동


---

## 로컬 테스트 (Local)
로컬 환경에서 테스트 시 `LobbyMapPath`, `PuzzleMapPath`는 **맵 에셋 경로가 아니라 접속용 Travel URL(Host:Port)** 로 사용했습니다.

- LobbyMapPath = "127.0.0.1:7777"
- PuzzleMapPath = "127.0.0.1:7778"

> 참고: 127.0.0.1은 같은 PC에서만 유효합니다. 다른 PC에서 접속 테스트 시에는 서버 PC의 IP로 변경해야 합니다.
